# å¾®ä¿¡æ‰«ç è¿›å…¥å°ç¨‹åº - å®Œæ•´æµç¨‹è¯´æ˜

## ğŸ“± ä¸€ã€æ‰«ç æ—¶åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

### 1.1 ç”¨æˆ·è§†è§’

```
ç”¨æˆ·æ‹¿èµ·æ‰‹æœº
  â†“
æ‰“å¼€å¾®ä¿¡æ‰«ä¸€æ‰«
  â†“
å¯¹å‡†å°ç¨‹åºç æ‰«æ
  â†“
å¾®ä¿¡è¯†åˆ«å‡ºè¿™æ˜¯ä¸€ä¸ªå°ç¨‹åºç 
  â†“
æ˜¾ç¤ºå°ç¨‹åºåç§°å’Œå›¾æ ‡
  â†“
ç”¨æˆ·ç‚¹å‡»"è¿›å…¥å°ç¨‹åº"
  â†“
å°ç¨‹åºæ‰“å¼€å¹¶è‡ªåŠ¨æŠ½ç­¾
```

### 1.2 æŠ€æœ¯è§†è§’

```
å¾®ä¿¡æ‰«æå°ç¨‹åºç 
  â†“
è§£æå°ç¨‹åºç ä¸­çš„æ•°æ®ï¼š
  {
    appId: "wx1234...",           // å°ç¨‹åºID
    page: "pages/home/home",      // é¡µé¢è·¯å¾„
    scene: "status=4"             // åœºæ™¯å‚æ•°ï¼ˆä¼šè¢«URLç¼–ç ï¼‰
  }
  â†“
å¾®ä¿¡æ‰“å¼€å°ç¨‹åº
  â†“
è·³è½¬åˆ°æŒ‡å®šé¡µé¢ pages/home/home
  â†“
è°ƒç”¨é¡µé¢çš„ onLoad(options) ç”Ÿå‘½å‘¨æœŸ
  â†“
options = {
  scene: "status%3D4"  // æ³¨æ„ï¼šè¿™é‡Œæ˜¯URLç¼–ç åçš„
}
  â†“
å°ç¨‹åºä»£ç è§£æ scene å‚æ•°
  â†“
decodeURIComponent("status%3D4") â†’ "status=4"
  â†“
è§£æå‡º status = 4
  â†“
è°ƒç”¨ autoDrawSign(4)
  â†“
è‡ªåŠ¨æŠ½å–ç¬¬4ç­¾
```

---

## ğŸ”§ äºŒã€å¦‚ä½•å¤åˆ»æ‰«ç è¿‡ç¨‹ï¼Ÿ

### æ–¹æ³•1ï¼šå¼€å‘è€…å·¥å…·æ¨¡æ‹Ÿï¼ˆâœ… ä½ å·²ç»æˆåŠŸï¼‰

#### é…ç½®ç¼–è¯‘æ¨¡å¼

```
æ¨¡å¼åç§°ï¼šæµ‹è¯•ç¬¬4ç­¾
å¯åŠ¨é¡µé¢ï¼špages/home/home
å¯åŠ¨å‚æ•°ï¼šstatus=4
```

#### åŸç†è¯´æ˜

è¿™ä¸ªæ–¹æ³•**ç›´æ¥ä¼ é€’å‚æ•°**ç»™é¡µé¢ï¼Œç›¸å½“äºï¼š
```javascript
onLoad(options) {
  // options = { status: "4" }
  // æˆ‘ä»¬çš„ä»£ç ä¼šæ£€æµ‹ options.status å¹¶è‡ªåŠ¨æŠ½ç­¾
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… å¿«é€Ÿæµ‹è¯•
- âœ… ä¸éœ€è¦ç”ŸæˆçœŸå®å°ç¨‹åºç 
- âœ… é€‚åˆå¼€å‘è°ƒè¯•

**ç¼ºç‚¹**ï¼š
- âŒ åªèƒ½åœ¨å¼€å‘è€…å·¥å…·ä¸­ä½¿ç”¨
- âŒ æ— æ³•æµ‹è¯•çœŸå®æ‰«ç åœºæ™¯

---

### æ–¹æ³•2ï¼šç”ŸæˆçœŸå®å°ç¨‹åºç ï¼ˆç”¨äºçº¿ä¸‹åœºæ™¯ï¼‰

#### æ­¥éª¤1ï¼šå‡†å¤‡åç«¯ç¯å¢ƒ

åˆ›å»ºä¸€ä¸ª Node.js è„šæœ¬æ¥ç”Ÿæˆå°ç¨‹åºç ã€‚

#### æ­¥éª¤2ï¼šè·å–å°ç¨‹åºå‡­è¯

1. ç™»å½• [å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/)
2. è¿›å…¥ã€Œå¼€å‘ã€â†’ã€Œå¼€å‘ç®¡ç†ã€â†’ã€Œå¼€å‘è®¾ç½®ã€
3. å¤åˆ¶ **AppID** å’Œ **AppSecret**

#### æ­¥éª¤3ï¼šè¿è¡Œç”Ÿæˆè„šæœ¬

```bash
# å®‰è£…ä¾èµ–
npm install axios

# ç”Ÿæˆç¬¬4ç­¾çš„å°ç¨‹åºç 
node scripts/generate-single-qrcode.js 4
```

#### æ­¥éª¤4ï¼šæ‰«æç”Ÿæˆçš„äºŒç»´ç 

ç”¨å¾®ä¿¡æ‰«æç”Ÿæˆçš„ `qrcode_sign_4.png`ï¼Œå°±ä¼šï¼š
1. æ‰“å¼€å°ç¨‹åº
2. è·³è½¬åˆ° `pages/home/home`
3. è‡ªåŠ¨æŠ½å–ç¬¬4ç­¾

---

## ğŸ“Š ä¸‰ã€ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”

| å¯¹æ¯”é¡¹ | å¼€å‘è€…å·¥å…·æ¨¡æ‹Ÿ | çœŸå®å°ç¨‹åºç  |
|-------|--------------|------------|
| **ä½¿ç”¨åœºæ™¯** | å¼€å‘è°ƒè¯• | çº¿ä¸‹å®é™…ä½¿ç”¨ |
| **å‚æ•°ä¼ é€’** | `options.status` | `options.scene` |
| **æ˜¯å¦éœ€è¦åç«¯** | âŒ ä¸éœ€è¦ | âœ… éœ€è¦ |
| **æ˜¯å¦éœ€è¦AppID** | âŒ ä¸éœ€è¦ | âœ… éœ€è¦ |
| **èƒ½å¦çœŸæœºæµ‹è¯•** | âŒ ä¸èƒ½ | âœ… èƒ½ |
| **ç”Ÿæˆé€Ÿåº¦** | âš¡ å³æ—¶ | ğŸ¢ éœ€è¦è°ƒç”¨API |

---

## ğŸ¯ å››ã€å°ç¨‹åºç ä¸­åˆ°åº•åŒ…å«äº†ä»€ä¹ˆï¼Ÿ

### 4.1 å°ç¨‹åºç çš„æœ¬è´¨

å°ç¨‹åºç æ˜¯ä¸€ä¸ª**åŠ å¯†çš„äºŒç»´ç **ï¼ŒåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

```javascript
{
  // å¿…éœ€ä¿¡æ¯
  appId: "wx1234567890abcdef",    // å°ç¨‹åºçš„å”¯ä¸€æ ‡è¯†
  
  // é¡µé¢ä¿¡æ¯
  page: "pages/home/home",         // è¦æ‰“å¼€çš„é¡µé¢è·¯å¾„
  
  // åœºæ™¯å‚æ•°ï¼ˆè¿™æ˜¯å…³é”®ï¼ï¼‰
  scene: "status=4",               // ä¼ é€’ç»™é¡µé¢çš„å‚æ•°
  
  // å¯é€‰é…ç½®
  width: 430,                      // äºŒç»´ç å®½åº¦
  line_color: {r: 212, g: 175, b: 55},  // çº¿æ¡é¢œè‰²
  is_hyaline: false                // æ˜¯å¦é€æ˜åº•è‰²
}
```

### 4.2 scene å‚æ•°çš„ç¼–ç è¿‡ç¨‹

```javascript
// 1. åç«¯ç”Ÿæˆå°ç¨‹åºç æ—¶
scene: "status=4"

// 2. å¾®ä¿¡è‡ªåŠ¨è¿›è¡Œ URL ç¼–ç 
scene: "status%3D4"  // = è¢«ç¼–ç ä¸º %3D

// 3. ç”¨æˆ·æ‰«ç åï¼Œå°ç¨‹åºæ¥æ”¶åˆ°
options.scene = "status%3D4"

// 4. å°ç¨‹åºä»£ç è§£ç 
decodeURIComponent("status%3D4")  // â†’ "status=4"

// 5. è§£æå‚æ•°
parseSceneParams("status=4")  // â†’ { status: "4" }

// 6. è½¬æ¢ä¸ºæ•°å­—
parseInt("4")  // â†’ 4

// 7. è‡ªåŠ¨æŠ½ç­¾
autoDrawSign(4)
```

---

## ğŸ’¡ äº”ã€å®é™…åº”ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šçº¿ä¸‹ç­¾æ¡

**åœºæ™¯**ï¼šä½ æœ‰61æ ¹å®ä½“ç­¾æ¡ï¼Œæƒ³è®©ç”¨æˆ·æ‰«ç æŸ¥çœ‹ç­¾æ–‡ã€‚

**å®ç°æ­¥éª¤**ï¼š

1. **ç”Ÿæˆ61ä¸ªå°ç¨‹åºç **
   ```bash
   node scripts/generate-all-qrcodes.js
   ```
   
2. **æ‰“å°äºŒç»´ç **
   - è¾“å‡ºç›®å½•ï¼š`qrcodes/`
   - æ–‡ä»¶ï¼š`sign_01.png` ~ `sign_61.png`

3. **è´´åœ¨ç­¾æ¡ä¸Š**
   - ç¬¬1ç­¾è´´ `sign_01.png`
   - ç¬¬2ç­¾è´´ `sign_02.png`
   - ...
   - ç¬¬61ç­¾è´´ `sign_61.png`

4. **ç”¨æˆ·ä½“éªŒ**
   ```
   ç”¨æˆ·æŠ½åˆ°ç¬¬4ç­¾
     â†“
   æ‰«æç­¾æ¡ä¸Šçš„äºŒç»´ç 
     â†“
   å°ç¨‹åºè‡ªåŠ¨æ‰“å¼€
     â†“
   æ˜¾ç¤º"æ­£åœ¨å¼€å¯ç¬¬4ç­¾"
     â†“
   å±•ç¤ºç¬¬4ç­¾çš„ç­¾æ–‡è¯¦æƒ…
   ```

---

### ç¤ºä¾‹2ï¼šæ´»åŠ¨æµ·æŠ¥

**åœºæ™¯**ï¼šä½ è¦åšä¸€ä¸ªæ–°å¹´æ´»åŠ¨ï¼Œæµ·æŠ¥ä¸Šæ”¾ä¸€ä¸ª"æŠ½å¤§å‰ç­¾"çš„äºŒç»´ç ã€‚

**å®ç°æ­¥éª¤**ï¼š

1. **ç”Ÿæˆç¬¬1ç­¾ï¼ˆå¤§å‰ï¼‰çš„å°ç¨‹åºç **
   ```bash
   node scripts/generate-single-qrcode.js 1
   ```

2. **è®¾è®¡æµ·æŠ¥**
   - æ”¾ä¸Šç”Ÿæˆçš„ `qrcode_sign_1.png`
   - æ–‡æ¡ˆï¼š"æ‰«ç æŠ½å¤§å‰ç­¾ï¼Œæ–°å¹´å¥½è¿æ¥ï¼"

3. **ç”¨æˆ·ä½“éªŒ**
   ```
   ç”¨æˆ·æ‰«ææµ·æŠ¥äºŒç»´ç 
     â†“
   å°ç¨‹åºæ‰“å¼€
     â†“
   è‡ªåŠ¨æŠ½å–ç¬¬1ç­¾ï¼ˆå¤§å‰-é£é¾™åœ¨å¤©ï¼‰
     â†“
   ç”¨æˆ·çœ‹åˆ°å‰ç¥¥ç­¾æ–‡
   ```

---

## ğŸ” å…­ã€è°ƒè¯•æŠ€å·§

### 6.1 æŸ¥çœ‹æ¥æ”¶åˆ°çš„å‚æ•°

åœ¨ `onLoad` ä¸­æ·»åŠ æ—¥å¿—ï¼š

```javascript
onLoad(options) {
  console.log('=== æ¥æ”¶åˆ°çš„å‚æ•° ===')
  console.log('å®Œæ•´ options:', options)
  console.log('options.scene:', options.scene)
  console.log('options.status:', options.status)
  console.log('==================')
  
  // ... å…¶ä»–ä»£ç 
}
```

### 6.2 æµ‹è¯•ä¸åŒçš„ç­¾å·

**å¼€å‘è€…å·¥å…·æµ‹è¯•**ï¼š
```
ç¼–è¯‘æ¨¡å¼1ï¼šstatus=1   â†’ æµ‹è¯•ç¬¬1ç­¾
ç¼–è¯‘æ¨¡å¼2ï¼šstatus=30  â†’ æµ‹è¯•ç¬¬30ç­¾
ç¼–è¯‘æ¨¡å¼3ï¼šstatus=61  â†’ æµ‹è¯•ç¬¬61ç­¾
ç¼–è¯‘æ¨¡å¼4ï¼šstatus=0   â†’ æµ‹è¯•æ— æ•ˆç­¾å·
ç¼–è¯‘æ¨¡å¼5ï¼šstatus=100 â†’ æµ‹è¯•è¶…å‡ºèŒƒå›´
```

### 6.3 çœŸæœºè°ƒè¯•

1. **é¢„è§ˆæ¨¡å¼**
   - ç‚¹å‡»å¼€å‘è€…å·¥å…·çš„ã€Œé¢„è§ˆã€æŒ‰é’®
   - ç”¨æ‰‹æœºå¾®ä¿¡æ‰«æé¢„è§ˆç 
   - åœ¨çœŸæœºä¸Šæµ‹è¯•ç¼–è¯‘æ¨¡å¼

2. **çœŸå®å°ç¨‹åºç **
   - ç”ŸæˆçœŸå®çš„å°ç¨‹åºç 
   - ç”¨æ‰‹æœºå¾®ä¿¡æ‰«æ
   - æµ‹è¯•å®Œæ•´çš„æ‰«ç æµç¨‹

---

## âš™ï¸ ä¸ƒã€ä»£ç å®ç°è¯¦è§£

### 7.1 æ¥æ”¶å‚æ•°ï¼ˆonLoadï¼‰

```javascript
onLoad(options) {
  // æ–¹å¼1ï¼šæ‰«ç è¿›å…¥ï¼ˆçœŸå®åœºæ™¯ï¼‰
  if (options.scene) {
    // options.scene = "status%3D4"ï¼ˆURLç¼–ç ï¼‰
    this.handleScanCode(options.scene)
  }
  
  // æ–¹å¼2ï¼šå¼€å‘è€…å·¥å…·ï¼ˆæµ‹è¯•åœºæ™¯ï¼‰
  else if (options.status) {
    // options.status = "4"
    const signNumber = parseInt(options.status)
    this.autoDrawSign(signNumber)
  }
}
```

### 7.2 è§£æ scene å‚æ•°

```javascript
handleScanCode(scene) {
  // 1. URL è§£ç 
  const sceneStr = decodeURIComponent(scene)
  // "status%3D4" â†’ "status=4"
  
  // 2. è§£æå‚æ•°
  const params = this.parseSceneParams(sceneStr)
  // "status=4" â†’ { status: "4" }
  
  // 3. è·å–ç­¾å·
  const signNumber = parseInt(params.status)
  // "4" â†’ 4
  
  // 4. éªŒè¯æœ‰æ•ˆæ€§
  if (signNumber >= 1 && signNumber <= 61) {
    this.autoDrawSign(signNumber)
  }
}
```

### 7.3 è§£æå‚æ•°å­—ç¬¦ä¸²

```javascript
parseSceneParams(sceneStr) {
  const params = {}
  const pairs = sceneStr.split('&')  // æŒ‰ & åˆ†å‰²
  
  pairs.forEach(pair => {
    const [key, value] = pair.split('=')  // æŒ‰ = åˆ†å‰²
    if (key && value) {
      params[key] = value
    }
  })
  
  return params
}

// ç¤ºä¾‹ï¼š
// "status=4" â†’ { status: "4" }
// "status=4&from=offline" â†’ { status: "4", from: "offline" }
```

---

## ğŸ“ å…«ã€å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆå¼€å‘è€…å·¥å…·ç”¨ statusï¼ŒçœŸå®æ‰«ç ç”¨ sceneï¼Ÿ

**ç­”**ï¼šè¿™æ˜¯å¾®ä¿¡å°ç¨‹åºçš„è®¾è®¡ï¼š
- **æ™®é€šè·³è½¬**ï¼šå‚æ•°ç›´æ¥ä¼ é€’ï¼Œå¦‚ `?status=4`
- **æ‰«ç è¿›å…¥**ï¼šå‚æ•°æ”¾åœ¨ `scene` å­—æ®µä¸­ï¼Œå¦‚ `?scene=status%3D4`

æˆ‘ä»¬çš„ä»£ç åŒæ—¶æ”¯æŒä¸¤ç§æ–¹å¼ï¼Œæ–¹ä¾¿å¼€å‘å’Œä½¿ç”¨ã€‚

### Q2: scene å‚æ•°æœ‰é•¿åº¦é™åˆ¶å—ï¼Ÿ

**ç­”**ï¼šæœ‰ï¼æœ€å¤§ **32ä¸ªå¯è§å­—ç¬¦**ã€‚

```javascript
// âœ… åˆæ³•
scene: "status=4"              // 8ä¸ªå­—ç¬¦
scene: "status=4&from=poster"  // 20ä¸ªå­—ç¬¦

// âŒ è¶…é•¿
scene: "status=4&from=poster&event=newyear&channel=wechat"  // è¶…è¿‡32å­—ç¬¦
```

### Q3: å¯ä»¥ä¼ é€’ä¸­æ–‡å—ï¼Ÿ

**ç­”**ï¼šå¯ä»¥ï¼Œä½†ä¼šå ç”¨æ›´å¤šå­—ç¬¦ï¼ˆURLç¼–ç åï¼‰ã€‚

```javascript
// åŸå§‹
scene: "status=4&name=è´¢ç¥ç­¾"

// URLç¼–ç åï¼ˆå ç”¨æ›´å¤šå­—ç¬¦ï¼‰
scene: "status=4&name=%E8%B4%A2%E7%A5%9E%E7%AD%BE"
```

å»ºè®®ï¼š**ç”¨æ•°å­—æˆ–è‹±æ–‡**ï¼ŒèŠ‚çœå­—ç¬¦æ•°ã€‚

---

## ğŸ‰ ä¹ã€æ€»ç»“

### æ‰«ç è¿‡ç¨‹çš„æœ¬è´¨

```
å°ç¨‹åºç  = ä¸€ä¸ªåŒ…å«äº† appId + page + scene çš„åŠ å¯†äºŒç»´ç 
æ‰«ç  = å¾®ä¿¡è§£æäºŒç»´ç  â†’ æ‰“å¼€å°ç¨‹åº â†’ ä¼ é€’å‚æ•°
å¤åˆ» = åœ¨å¼€å‘å·¥å…·ä¸­ç›´æ¥ä¼ é€’å‚æ•°ï¼Œè·³è¿‡æ‰«ç æ­¥éª¤
```

### ä¸¤ç§æµ‹è¯•æ–¹å¼

| æ–¹å¼ | é€‚ç”¨åœºæ™¯ | å‚æ•°æ ¼å¼ |
|-----|---------|---------|
| **å¼€å‘è€…å·¥å…·** | å¿«é€Ÿè°ƒè¯• | `status=4` |
| **çœŸå®å°ç¨‹åºç ** | çº¿ä¸‹ä½¿ç”¨ | `scene=status%3D4` |

### å…³é”®ä»£ç 

```javascript
// åŒæ—¶æ”¯æŒä¸¤ç§æ–¹å¼
onLoad(options) {
  if (options.scene) {
    // çœŸå®æ‰«ç ï¼šè§£æ scene
    this.handleScanCode(options.scene)
  } else if (options.status) {
    // å¼€å‘æµ‹è¯•ï¼šç›´æ¥ä½¿ç”¨ status
    this.autoDrawSign(parseInt(options.status))
  }
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [äºŒç»´ç ç”Ÿæˆè¯´æ˜.md](./äºŒç»´ç ç”Ÿæˆè¯´æ˜.md) - å¦‚ä½•ç”Ÿæˆå°ç¨‹åºç 
- [æ‰«ç è‡ªåŠ¨æŠ½ç­¾æµ‹è¯•è¯´æ˜.md](./æ‰«ç è‡ªåŠ¨æŠ½ç­¾æµ‹è¯•è¯´æ˜.md) - æµ‹è¯•æ–¹æ³•
- [å¾®ä¿¡å®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/qr-code/wxacode.getUnlimited.html)

---

**ç°åœ¨ä½ å·²ç»å®Œå…¨ç†è§£æ‰«ç çš„åŸç†äº†ï¼** ğŸŠ

å¦‚æœè¦åœ¨çœŸå®ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œè®°å¾—ï¼š
1. é…ç½®å¥½ AppID å’Œ AppSecret
2. è¿è¡Œè„šæœ¬ç”Ÿæˆå°ç¨‹åºç 
3. æ‰“å°å¹¶è´´åœ¨ç­¾æ¡ä¸Š
4. ç”¨æˆ·æ‰«ç å³å¯è‡ªåŠ¨æŠ½ç­¾ï¼

