# 朕瓷灵签 - 技术栈说明

> 本文档说明项目的技术栈、项目结构、开发方式和注意事项

## 一、当前技术栈

### 开发方式
**原生微信小程序开发**（不使用任何框架）

### 核心技术
- **WXML** - 微信小程序标记语言（类似HTML）
- **WXSS** - 微信小程序样式语言（类似CSS）
- **JavaScript** - 业务逻辑
- **微信小程序API** - 原生API调用

### 开发工具
- **微信开发者工具** - 官方IDE
- **项目配置** - project.config.json
- **应用配置** - miniprogram/app.json

### 数据存储
- **本地存储** - wx.setStorageSync/getStorageSync
- **无后端** - 所有数据存储在本地

### 扫码功能
- **小程序码** - 微信官方 getUnlimited API
- **场景值传递** - scene 参数传递签号信息
- **自动抽签** - 扫码后自动触发指定签号

### 黄历功能 ✨新增
- **纯前端算法** - 无需后端API，本地计算
- **农历转换** - 公历转农历算法
- **宜忌查询** - 每日宜忌事项
- **吉时查询** - 每日吉时推荐
- **节气显示** - 二十四节气提醒

---

## 二、项目结构

```
TaoismMP/
├── project.config.json          # 项目配置文件
├── miniprogram/                 # 小程序源代码目录
│   ├── app.json                 # 应用配置（含tabBar配置）
│   ├── app.js                   # 应用入口
│   ├── app.wxss                 # 全局样式
│   ├── sitemap.json             # 网站地图
│   ├── data/
│   │   ├── signs.js             # 签文数据（61签）
│   │   └── lunar.js             # 黄历数据模块 ✨新增
│   ├── assets/                  # 资源文件
│   │   ├── images/              # 图片资源
│   │   │   └── drum.png         # 签筒图片
│   │   └── audio/               # 音频资源
│   │       └── shake.mp3        # 摇签音效
│   ├── utils/
│   │   └── util.js              # 工具函数
│   └── pages/
│       ├── home/                # 首页（抽签页）
│       │   ├── home.js          # 页面逻辑（含扫码自动抽签）
│       │   ├── home.json        # 页面配置
│       │   ├── home.wxml        # 页面结构
│       │   └── home.wxss        # 页面样式
│       ├── lunar/               # 黄历页面 ✨新增
│       │   ├── lunar.js         # 黄历页面逻辑
│       │   ├── lunar.json       # 页面配置
│       │   ├── lunar.wxml       # 页面结构
│       │   └── lunar.wxss       # 页面样式
│       ├── draw/                # 抽签动画页
│       ├── result/              # 签文详情页
│       └── history/             # 历史记录页
├── scripts/                     # 脚本工具
│   └── generate-single-qrcode.js  # 生成小程序码脚本
├── README.md                    # 项目说明
├── 技术栈说明.md                # 技术栈文档
├── 扫码自动抽签测试说明.md      # 扫码功能测试文档
├── 二维码生成说明.md            # 二维码生成指南
├── 微信扫码原理说明.md          # 扫码原理详解
└── TabBar图标准备说明.md        # TabBar图标说明 ✨新增
```

---

## 三、微信开发者工具打开目录

### ⚠️ 重要：打开的是项目根目录

**正确的目录**：
```
/Users/huangchangwei/Desktop/gitSpaceC/TaoismMP
```

**不是这个目录**：
```
❌ /Users/huangchangwei/Desktop/gitSpaceC/TaoismMP/miniprogram
```

### 导入步骤

1. 打开微信开发者工具
2. 点击"导入项目"
3. 填写以下信息：
   - **项目路径**：`/Users/huangchangwei/Desktop/gitSpaceC/TaoismMP`
   - **AppID**：`wx640831368d15e774`
   - **项目名称**：`朕瓷灵签`
4. 点击"导入"

---

## 四、项目配置说明

### project.config.json
```json
{
  "appid": "wx640831368d15e774",
  "projectname": "zhenci-lingqian",
  "miniprogramRoot": "miniprogram/",
  "compileType": "miniprogram"
}
```

**说明**：
- `appid` - 微信小程序ID
- `projectname` - 项目名称
- `miniprogramRoot` - 小程序源代码目录（相对于项目根目录）
- `compileType` - 编译类型（miniprogram = 小程序）

---

## 五、文件说明

### 核心文件

| 文件 | 说明 |
|------|------|
| `miniprogram/app.json` | 应用配置（页面、导航栏、tabBar等） |
| `miniprogram/app.js` | 应用入口和全局数据 |
| `miniprogram/app.wxss` | 全局样式 |
| `miniprogram/data/signs.js` | 签文数据库 |
| `miniprogram/utils/util.js` | 工具函数 |

### 页面文件

每个页面包含4个文件：
- `.js` - 页面逻辑
- `.wxml` - 页面结构
- `.wxss` - 页面样式
- `.json` - 页面配置

---

## 六、核心功能

### 首页 (pages/home/)
- **签筒展示** - 使用图片展示精美的红色签筒
- **点击抽签** - 点击签筒触发抽签动画
- **摇手机抽签** - 摇晃手机自动触发抽签（使用加速度计API）
- **扫码自动抽签** - 扫描带参数的小程序码自动抽取指定签号 ✨新增
- **摇签音效** - 抽签时播放音效（1秒后自动停止）
- **签筒动画** - 摇晃动画效果
- **弹出签条** - 抽中的签条从签筒中弹出
- **签文展示** - 显示签号、签级、签诗
- **语音播报** - 自动播报签诗内容
- **详细解签** - 点击展开查看完整解签
- **再求一签** - 继续抽签功能

### 黄历页面 (pages/lunar/) ✨新增
- **公历日期** - 显示当前公历年月日、星期
- **农历日期** - 显示农历年月日
- **干支纪年** - 显示天干地支纪年
- **生肖显示** - 显示当年生肖
- **节气提醒** - 显示当日节气（如有）
- **今日宜忌** - 显示适宜和忌讳的事项
- **吉时查询** - 显示当日吉时时辰
- **刷新功能** - 手动刷新黄历数据

### 抽签页 (pages/draw/)
- 签筒旋转动画（3秒）
- 随机生成签文
- 显示签号、签名、签诗

### 结果页 (pages/result/)
- 完整的签文信息
- 签义和建议
- 分享和复制功能

### 历史页 (pages/history/)
- 查看所有抽签记录
- 按分类筛选（吉/中/凶）
- 删除单条或清空所有记录

---

## 七、本地存储

### 存储位置
```javascript
// 存储在微信小程序的本地存储中
localStorage key: "zhenci_records"
```

### 数据结构
```javascript
{
  "zhenci_records": [
    {
      "id": "record_1234567890_abc123",
      "sign": { /* 签文对象 */ },
      "drawTime": "2024-01-15 10:30"
    }
  ]
}
```

---

## 八、快速开始

### 1. 打开微信开发者工具
下载：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html

### 2. 导入项目
- 项目路径：`/Users/huangchangwei/Desktop/gitSpaceC/TaoismMP`
- AppID：`wx640831368d15e774`

### 3. 查看效果
- 在模拟器中点击"立即抽签"

---

## 九、开发注意事项

### WXML 语法
```wxml
<!-- 条件渲染 -->
<view wx:if="{{condition}}">显示</view>

<!-- 列表渲染 -->
<view wx:for="{{list}}" wx:key="id">{{item.name}}</view>

<!-- 事件绑定 -->
<button bindtap="handleClick">点击</button>
```

### WXSS 单位
- `rpx` - 响应式像素（推荐使用）
- `px` - 物理像素
- `em` - 相对单位

### JavaScript API
```javascript
// 本地存储
wx.setStorageSync('key', value)
wx.getStorageSync('key')
wx.removeStorageSync('key')

// 页面导航
wx.navigateTo({ url: '/pages/home/home' })
wx.navigateBack()

// 提示框
wx.showToast({ title: '提示', icon: 'success' })
wx.showModal({ title: '标题', content: '内容' })

// 加速度计（摇手机抽签）
wx.startAccelerometer({ interval: 'normal' })
wx.onAccelerometerChange((res) => {
  console.log(res.x, res.y, res.z)
})
wx.stopAccelerometer()

// 音频播放（摇签音效）
const audioContext = wx.createInnerAudioContext()
audioContext.src = '/assets/audio/shake.mp3'
audioContext.play()
audioContext.stop()
```

---

## 十、项目统计

- **总文件数**：约30个
- **页面数**：4个
- **签文数**：100个（完整版）
- **代码行数**：约800行（已优化，移除Canvas代码）
- **项目大小**：约200KB（含图片和音频）

---

## 十一、最新功能特性

### ✅ 已实现功能
1. **图片签筒** - 使用精美的签筒图片替代Canvas绘制
2. **摇手机抽签** - 使用加速度计API，摇晃手机触发抽签
3. **摇签音效** - 抽签时播放音效，1秒后自动停止
4. **签筒动画** - 摇晃动画效果
5. **弹出签条** - 签条从签筒中弹出的动画
6. **详细解签** - 点击展开查看完整解签内容
7. **文案优化** - "再抽一次" → "再求一签"
8. **扫码自动抽签** ✨新增 - 扫描小程序码自动抽取指定签号
9. **语音播报** - 自动播报签诗内容
10. **黄历查询** ✨新增 - 传统黄历功能，纯前端实现

### 🎨 UI特点
- **红色喜庆风格** - 传统中国风配色
- **金色装饰** - 高贵典雅
- **流畅动画** - 摇晃、弹出等动画效果
- **响应式设计** - 适配不同屏幕尺寸

### 📱 交互方式
1. **点击签筒** - 直接点击触发抽签
2. **摇晃手机** - 摇晃手机触发抽签（真机有效）
3. **扫描二维码** ✨新增 - 扫描小程序码自动抽取指定签号
4. **点击展开** - 点击签文卡片查看详细解签
5. **再求一签** - 继续抽签
6. **底部导航** ✨新增 - 在抽签和黄历页面之间切换

---

**技术栈**：原生微信小程序
**版本**：1.0.0
**状态**：✅ 完成并可用
**最后更新**：2024年

